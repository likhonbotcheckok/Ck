const { ADMIN_UID, ADMIN_USERNAME } = require('../config/botConfig');

module.exports = (bot) => {
  const isAdmin = (msg) => {
    const userId = msg.from.id.toString();
    const username = msg.from.username || '';
    return (
      userId === ADMIN_UID ||
      username.toLowerCase() === ADMIN_USERNAME.toLowerCase()
    );
  };

  // ЁЯФТ LOCK COMMAND
  bot.onText(/^\/lock$/, async (msg) => {
    const chatId = msg.chat.id;
    if (!['group', 'supergroup'].includes(msg.chat.type)) {
      return bot.sendMessage(chatId, "тЭМ ржПржЗ ржХржорж╛ржирзНржб рж╢рзБржзрзБ ржЧрзНрж░рзБржкрзЗ ржХрж╛ржЬ ржХрж░рзЗред");
    }

    if (!isAdmin(msg)) {
      return bot.sendMessage(chatId, "тЫФ рж╢рзБржзрзБржорж╛рждрзНрж░ ржЕрзНржпрж╛ржбржорж┐ржирж░рж╛ ржПржЗ ржХржорж╛ржирзНржб ржЪрж╛рж▓рж╛рждрзЗ ржкрж╛рж░рзЗред");
    }

    try {
      await bot.setChatPermissions(chatId, {
        can_send_messages: false,
        can_send_media_messages: false,
        can_send_polls: false,
        can_send_other_messages: false,
        can_add_web_page_previews: false,
        can_invite_users: false,
        can_pin_messages: false,
        can_change_info: false,
      });

      return bot.sendMessage(chatId, "ЁЯФТ ржкрзБрж░рзЛ ржЧрзНрж░рзБржк рж▓ржХржб рж╣ржпрж╝рзЗржЫрзЗ тЬЕ", {
        parse_mode: "Markdown",
        message_thread_id: msg.is_topic_message ? msg.message_thread_id : undefined,
      });
    } catch (err) {
      console.error("Lock command error:", err);
      return bot.sendMessage(chatId, "тЪая╕П ржХрж┐ржЫрзБ ржнрзБрж▓ рж╣ржпрж╝рзЗржЫрзЗ рж▓ржХ ржХрж░рждрзЗ ржЧрж┐ржпрж╝рзЗред");
    }
  });

  // ЁЯФУ UNLOCK COMMAND
  bot.onText(/^\/unlock$/, async (msg) => {
    const chatId = msg.chat.id;
    if (!['group', 'supergroup'].includes(msg.chat.type)) {
      return bot.sendMessage(chatId, "тЭМ ржПржЗ ржХржорж╛ржирзНржб рж╢рзБржзрзБ ржЧрзНрж░рзБржкрзЗ ржХрж╛ржЬ ржХрж░рзЗред");
    }

    if (!isAdmin(msg)) {
      return bot.sendMessage(chatId, "тЫФ рж╢рзБржзрзБржорж╛рждрзНрж░ ржЕрзНржпрж╛ржбржорж┐ржирж░рж╛ ржПржЗ ржХржорж╛ржирзНржб ржЪрж╛рж▓рж╛рждрзЗ ржкрж╛рж░рзЗред");
    }

    try {
      await bot.setChatPermissions(chatId, {
        can_send_messages: true,
        can_send_media_messages: true,
        can_send_polls: true,
        can_send_other_messages: true,
        can_add_web_page_previews: true,
        can_invite_users: true,
        can_pin_messages: true,
        can_change_info: false,
      });

      return bot.sendMessage(chatId, "ЁЯФУ ржЧрзНрж░рзБржк ржЖржирж▓ржХржб тЬЕ", {
        parse_mode: "Markdown",
        message_thread_id: msg.is_topic_message ? msg.message_thread_id : undefined,
      });
    } catch (err) {
      console.error("Unlock command error:", err);
      return bot.sendMessage(chatId, "тЪая╕П ржХрж┐ржЫрзБ ржнрзБрж▓ рж╣ржпрж╝рзЗржЫрзЗ ржЖржирж▓ржХ ржХрж░рждрзЗ ржЧрж┐ржпрж╝рзЗред");
    }
  });
};
